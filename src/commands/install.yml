description: >
  Install jq in a CircleCI job. Supports jq versions 1.3 and newer.
  Requirements: bash, curl, gpg, grep, sed, sha256sum, tar

parameters:
  version:
    type: string
    default: latest
    description: >
      Version of jq to install, defaults to `latest`. If specifying a
      version other than latest, provide a full release tag, as listed at
      https://api.github.com/repos/stedolan/jq/releases, e.g., `jq-1.6`.

  install-dir:
    type: string
    default: ~/bin
    description: >
      Directory in which to install jq

  override:
    type: boolean
    default: false
    description: |
      Whether or not to remove a pre-existing version of jq when this version
      is installed.

  when:
    type: enum
    default: "always"
    description: When to run the command.
    enum: ["always", "on_fail", "on_success"]

steps:
  - run:
      when: << parameters.when >>
      name: Install jq
      environment:
        ORB_VAL_VERSION: <<parameters.version>>
        ORB_VAL_OVERRIDE: <<parameters.override>>
        ORB_EVAL_INSTALL_DIR: <<parameters.install-dir>>
      command: << include(scripts/install.sh) >>
